devtools::install()
devtools::install()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::install()
devtools::document()
devtools::install()
devtools::document()
devtools::install()
devtools::install()
devtools::install()
devtools::install()
setwd("C:/Users/Megan/github/bpwtpR")
setwd("C:/Users/Megan/github/BPWTP_labdat/docs")
setwd("../")
getwd()
labdat <- read_labdat(datadir = "./data",
labdat_file = "BPWTP_routinelabdata_historicalbase_scraped.csv")
devtools::load_all("../bpwtpR")
labdat <- read_labdat(datadir = "./data",
labdat_file = "BPWTP_routinelabdata_historicalbase_scraped.csv")
head(labdat)
labdat <- read_labdat(labdat_file = "BPWTP_routinelabdata_historicalbase_clean.csv", datadir = "./data")
current_year = 2019
df = labdat
year_select = 2018
grouping = "physical"
sampling_station = "Raw"
percentiles = c("0.25", "0.75")
month_select = NULL
if(is.null(month_select)){
month_select = month(Sys.Date(), label = T, abbr = T)}
library(lubridate)
if(is.null(month_select)){
month_select = month(Sys.Date(), label = T, abbr = T)}
month_select
df <- df %>%
filter(parm_tag == grouping & station == sampling_station)
month_values <- summarize_monthly(labdat = df) %>%
filter(month == month_select, year == year_select)
library(tidyverse)
month_values <- summarize_monthly(labdat = df) %>%
filter(month == month_select, year == year_select)
hist_ext <- historical_extremes(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
by_month = T
hist_ext <- historical_extremes(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist_per <- historical_percentiles(df = df, grouping = grouping,
sampling_station = sampling_station,
percentiles = percentiles, by_month = by_month)
percentiles = c(0.25, 0.75)
hist_per <- historical_percentiles(df = df, grouping = grouping,
sampling_station = sampling_station,
percentiles = percentiles, by_month = by_month)
hist_bas <- historical_basics(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist.values <- left_join(hist_bas, hist_ext) %>%
left_join(hist_per) %>%
filter(month == month_select)
hist.values <- left_join(hist_bas, hist_ext) %>%
left_join(hist_per)
head(hist.values)
month_select
str(hist.values)
hist.values <- left_join(hist_bas, hist_ext) %>%
left_join(hist_per) %>%
as.data.frame() %>%
filter(month == month_select)
hist.values <- hist.values[hist.values, month == month_select,]
hist.values <- hist.values[hist.values$month == month_select,]
month()
?month
month.abb
hist.values$month <- factor(hist.values$month, ordered = T, levels = month.abb)
str(hist.values)
hist.values <- hist.values[hist.values$month == month_select,]
table.values <- left_join(month_values, hist.values)
table.values <- as.data.frame(table.values)
table.values
table.values <- left_join(month_values, hist.values) %>%
select(parameter, unti, Monthly:ncol())
table.values <- left_join(month_values, hist.values) %>%
select(parameter, unit, Monthly:ncol())
table.values <- left_join(month_values, hist.values) %>%
select(parameter, unit, `Monthly Mean`:ncol())
tail(percentiles)[1]
hist_per
percentiles[length(percentiles)]
table.values <- left_join(month_values, hist.values) %>%
select(parameter, unit, `Monthly Mean`:paste0("`", percentiles[length(percentiles)],"%`"))
table.values <- left_join(month_values, hist.values) %>%
select(parameter, unit, `Monthly Mean`:percentiles[length(percentiles)])
table.values <- left_join(month_values, hist.values)
table.values <- as.data.frame(table.values)
table.values
table.values[,c(6, 1, 7:ncol(table.values)]
table.values[, c(6,1)]
table.values[, c(6,2)]
table.values[, c(6,2,7:10)]
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values)- 6)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
caption.text = paste(sampling_station, grouping, "characterics for",
month_select, "historical data.")
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values)- 6)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values) - 5)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
caption.text = paste(sampling_station, grouping, "characterics for",
month_select, year_select, "with", month_select,
"historical data from", min(df$year), "-", max(df$year), ".")
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values) - 5)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
table.values <- left_join(hist_bas, hist_ext) %>% left_join(hist_per)
table.values
#'
#' @param df
#' @param sampling_station
#' @param grouping
#' @param by_month
#'
#' @return
#' @export
#'
#' @examples
historical_extremes <- function(df = "", sampling_station = "",
grouping = "", by_month = T){
if(by_month == T){
df %>%
filter(parm_tag == grouping & station == sampling_station) %>%
group_by(station, parameter, unit, month) %>%
summarize("Min" = min(result, na.rm = TRUE), "Max" = max(result, na.rm = TRUE))
} else {
df %>%
filter(parm_tag == grouping & station == sampling_station) %>%
group_by(station, parameter, unit) %>%
summarize("Min" = min(result, na.rm = TRUE), "Max" = max(result, na.rm = TRUE))
}
}
#'
#' @param df
#' @param sampling_station
#' @param grouping
#' @param by_month
#'
#' @return
#' @export
#'
#' @examples
historical_basics <- function(df = "", sampling_station = "", grouping = "", by_month = T){
if(by_month == T){
df %>%
filter(parm_tag == grouping & station == sampling_station) %>%
group_by(station, parameter, unit, month) %>%
summarize(N = n(), Mean = mean(result, na.rm = T),
SD = sd(result, na.rm = T), CV = (SD/N)*100)
} else{
df %>%
filter(parm_tag == grouping & station == sampling_station) %>%
group_by(station, parameter, unit) %>%
summarize(N = n(), Mean = mean(result, na.rm = T),
SD = sd(result, na.rm = T), CV = (SD/N)*100)
}
}
#' @param df
#' @param percentiles
#' @param sampling_station
#' @param grouping
#' @param by_month
#'
#' @return
#' @export
#'
#' @examples
historical_percentiles <- function(df = "", percentiles = c(0.1, .25, .50, .75, .9),
sampling_station = "", grouping = "",
by_month = T){
p_names <- map_chr(percentiles, ~paste0(.x*100, "%"))
p_funs <- map(percentiles, ~ partial(quantile, probs = .x, na.rm = TRUE)) %>%
set_names(nm = p_names)
if(by_month == T){
df %>%
filter(parm_tag == grouping & station == sampling_station) %>%
group_by(station, parameter, unit, month) %>%
summarize_at(vars(result), funs(!!!p_funs))
} else {
df %>%
filter(parm_tag == grouping & station == sampling_station) %>%
group_by(station, parameter, unit) %>%
summarize_at(vars(result), funs(!!!p_funs))
}
}
month_values <- summarize_monthly(labdat = df) %>%
filter(month == month_select, year == year_select)
hist_ext <- historical_extremes(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist_per <- historical_percentiles(df = df, grouping = grouping,
sampling_station = sampling_station,
percentiles = percentiles, by_month = by_month)
hist_bas <- historical_basics(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist.values <- left_join(hist_bas, hist_ext) %>%
left_join(hist_per)
hist.values$month <- factor(hist.values$month, ordered = T, levels = month.abb)
hist.values <- hist.values[hist.values$month == month_select,]
table.values <- left_join(month_values, hist.values)
table.values <- as.data.frame(table.values)
table.values
caption.text = paste(sampling_station, grouping, "characterics for",
month_select, year_select, "with collated", month_select,
"historical data from", min(df$year), "-", max(df$year), ".")
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values) - 5)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
table.values <- left_join(hist_bas, hist_ext) %>% left_join(hist_per)
table.values
caption.text = paste("Overall historical summary (", min(df$year), "-", max(df$year),
") for", sampling_station, grouping, "water quality characteristics.")
pander(table.values[,2:ncol(table.values)],
justify = c("left", rep("centre",ncol(table.values)-2)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
?prettyNum
#' @param grouping
#' @param sampling_station
#' @param percentiles
#' @param by_month
#' @param month_select
#'
#' @return
#' @export
#'
#' @examples
group_table_historical <- function(df = "", year_select = "", grouping = "",
sampling_station = "", percentiles = "",
by_month = T, month_select = NULL){
if(is.null(month_select)){
month_select = month(Sys.Date(), label = T, abbr = T)}
df <- df %>%
filter(parm_tag == grouping & station == sampling_station)
month_values <- summarize_monthly(labdat = df) %>%
filter(month == month_select, year == year_select)
hist_ext <- historical_extremes(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist_per <- historical_percentiles(df = df, grouping = grouping,
sampling_station = sampling_station,
percentiles = percentiles, by_month = by_month)
hist_bas <- historical_basics(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
if(by_month == T) {
hist.values <- left_join(hist_bas, hist_ext) %>%
left_join(hist_per)
hist.values$month <- factor(hist.values$month, ordered = T, levels = month.abb)
hist.values <- hist.values[hist.values$month == month_select,]
table.values <- left_join(month_values, hist.values)
table.values <- as.data.frame(table.values)
caption.text = paste(sampling_station, grouping, "characterics for",
month_select, year_select, "with collated", month_select,
"historical data from", min(df$year), "-", max(df$year), ".")
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values) - 5)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
} else {
table.values <- left_join(hist_bas, hist_ext) %>% left_join(hist_per)
caption.text = paste("Overall historical summary (", min(df$year), "-", max(df$year),
") for", sampling_station, grouping, "water quality characteristics.")
pander(table.values[,2:ncol(table.values)],
justify = c("left", rep("centre",ncol(table.values)-2)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
}
}
group_table_historical(df = labdat, year_select = current_year,
grouping = "operations", sampling_station = "Raw",
percentiles = c(0.1, 0.25, 0.5, 0.75, 0.9), by_month = T)
group_table_historical(df = labdat, year_select = current_year,
grouping = "operations", sampling_station = "Raw",
percentiles = c(0.1, 0.25, 0.5, 0.75, 0.9), by_month = F)
table.values
is.na(table.values)
table.values[is.na(table.values)] <- "--"
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
table.values
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values) - 5)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
table.values <- left_join(month_values, hist.values)
table.values <- as.data.frame(table.values)
table.values
table.values[,c(`Montly Mean`:ncol(table.values))] <- signif(table.values[,c(`Montly Mean`:ncol(table.values))])
table.values[,c(`Monthly Mean`:ncol(table.values))] <- signif(table.values[,c(`Monthly Mean`:ncol(table.values))])
table.values[,c(7:ncol(table.values))] <- signif(table.values[,c(7:ncol(table.values))])
table.values
table.values[,c(7:ncol(table.values))] <- prettyNum(table.values[,c(7:ncol(table.values))],
small.interval = 2)
table.values[,c(7:ncol(table.values))] <- signif(table.values[,c(7:ncol(table.values))], digits = 2)
table.values[,c(7:ncol(table.values))]
table.values <- as.data.frame(table.values)
table.values[,c(7:ncol(table.values))] <- signif(table.values[,c(7:ncol(table.values))], digits = 3)
table.values
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
caption.text = paste(sampling_station, grouping, "characterics for",
month_select, year_select, "with collated", month_select,
"historical data from", min(df$year), "-", max(df$year), ".")
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", rep("center",ncol(table.values) - 5)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", "center", rep("right", ncol(table.values) - 6)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
by_month = F
hist_ext <- historical_extremes(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist_per <- historical_percentiles(df = df, grouping = grouping,
sampling_station = sampling_station,
percentiles = percentiles, by_month = by_month)
hist_bas <- historical_basics(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
table.values <- left_join(hist_bas, hist_ext) %>% left_join(hist_per)
table.values
table.values[,c(5:ncol(table.values))] <- signif(table.values[,c(5:ncol(table.values))], digits = 3)
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
caption.text = paste("Overall historical summary (", min(df$year), "-", max(df$year),
") for", sampling_station, grouping, "water quality characteristics.")
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("left",ncol(table.values) - 1)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("left",ncol(table.values) - 2)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("left",ncol(table.values) - 3)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("right",ncol(table.values) - 3)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
caption.text = paste0("Overall historical summary (", min(df$year), "-", max(df$year),
") for ", sampling_station, grouping, " water quality characteristics.")
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("right",ncol(table.values) - 3)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
caption.text = paste0("Overall historical summary (", min(df$year), "-", max(df$year),
") for ", sampling_station, " ", grouping, " water quality characteristics.")
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("right",ncol(table.values) - 3)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
#' @param grouping
#' @param sampling_station
#' @param percentiles
#' @param by_month
#' @param month_select
#'
#' @return
#' @export
#'
#' @examples
group_table_historical <- function(df = "", year_select = "", grouping = "",
sampling_station = "", percentiles = "",
by_month = T, month_select = NULL){
if(is.null(month_select)){
month_select = month(Sys.Date(), label = T, abbr = T)}
df <- df %>%
filter(parm_tag == grouping & station == sampling_station)
month_values <- summarize_monthly(labdat = df) %>%
filter(month == month_select, year == year_select)
hist_ext <- historical_extremes(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist_per <- historical_percentiles(df = df, grouping = grouping,
sampling_station = sampling_station,
percentiles = percentiles, by_month = by_month)
hist_bas <- historical_basics(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
if(by_month == T) {
hist.values <- left_join(hist_bas, hist_ext) %>%
left_join(hist_per)
hist.values$month <- factor(hist.values$month, ordered = T, levels = month.abb)
hist.values <- hist.values[hist.values$month == month_select,]
table.values <- left_join(month_values, hist.values)
table.values <- as.data.frame(table.values)
table.values[,c(7:ncol(table.values))] <- signif(table.values[,c(7:ncol(table.values))], digits = 3)
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
caption.text = paste(sampling_station, grouping, "characterics for",
month_select, year_select, "with collated", month_select,
"historical data from", min(df$year), "-", max(df$year), ".")
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", "center", rep("right", ncol(table.values) - 6)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
} else {
table.values <- left_join(hist_bas, hist_ext) %>% left_join(hist_per)
table.values[,c(5:ncol(table.values))] <- signif(table.values[,c(5:ncol(table.values))], digits = 3)
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
caption.text = paste0("Overall historical summary (", min(df$year), "-", max(df$year),
") for ", sampling_station, " ", grouping, " water quality characteristics.")
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("right",ncol(table.values) - 3)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9, digits = 2)
}
}
group_table_historical(df = labdat, year_select = current_year,
grouping = "operations", sampling_station = "Raw",
percentiles = c(0.1, 0.25, 0.5, 0.75, 0.9), by_month = T)
group_table_historical(df = labdat, year_select = current_year,
grouping = "operations", sampling_station = "Raw",
percentiles = c(0.1, 0.25, 0.5, 0.75, 0.9), by_month = F)
#' @param grouping
#' @param sampling_station
#' @param percentiles
#' @param by_month
#' @param month_select
#'
#' @return
#' @export
#'
#' @examples
group_table_historical <- function(df = "", year_select = "", grouping = "",
sampling_station = "", percentiles = "",
by_month = T, month_select = NULL){
if(is.null(month_select)){
month_select = month(Sys.Date(), label = T, abbr = T)}
df <- df %>%
filter(parm_tag == grouping & station == sampling_station)
month_values <- summarize_monthly(labdat = df) %>%
filter(month == month_select, year == year_select)
hist_ext <- historical_extremes(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
hist_per <- historical_percentiles(df = df, grouping = grouping,
sampling_station = sampling_station,
percentiles = percentiles, by_month = by_month)
hist_bas <- historical_basics(df = df, grouping = grouping,
sampling_station = sampling_station, by_month = by_month)
if(by_month == T) {
hist.values <- left_join(hist_bas, hist_ext) %>%
left_join(hist_per)
hist.values$month <- factor(hist.values$month, ordered = T, levels = month.abb)
hist.values <- hist.values[hist.values$month == month_select,]
table.values <- left_join(month_values, hist.values)
table.values <- as.data.frame(table.values)
table.values[,c(7:ncol(table.values))] <- signif(table.values[,c(7:ncol(table.values))], digits = 3)
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
caption.text = paste(sampling_station, grouping, "characterics for",
month_select, year_select, "with collated", month_select,
"historical data from", min(df$year), "-", max(df$year), ".")
pander(table.values[, c(6, 2, 7:ncol(table.values))],
justify = c("left", "center", rep("right", ncol(table.values) - 6)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9)
} else {
table.values <- left_join(hist_bas, hist_ext) %>% left_join(hist_per)
table.values[,c(5:ncol(table.values))] <- signif(table.values[,c(5:ncol(table.values))], digits = 3)
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
caption.text = paste0("Overall historical summary (", min(df$year), "-", max(df$year),
") for ", sampling_station, " ", grouping, " water quality characteristics.")
pander(table.values[,2:ncol(table.values)],
justify = c("left", "center", rep("right",ncol(table.values) - 3)),
style = "rmarkdown", split.table = Inf,
caption = caption.text, graph.fontsize = 9)
}
}
group_table_historical(df = labdat, year_select = current_year,
grouping = "operations", sampling_station = "Raw",
percentiles = c(0.1, 0.25, 0.5, 0.75, 0.9), by_month = T)
devtools::install("../bpwtpR")
df <- df %>%
filter(parm_tag == grouping & station == sampling_station,
year(datetime_ymd.hms) == year_select)
table.values <- summarize_monthly(labdat = df)
table.values <- table.values %>%
select(month, parameter, unit, `Monthly Mean`) %>%
spread(month, `Monthly Mean`)
table.values
table.values[,c(3:ncol(table.values))] <- signif(table.values[,c(3:ncol(table.values))], digits = 3)
table.values <- as.matrix(table.values)
table.values[is.na(table.values)] <- "--"
table.values
devtools::install("../bpwtpR")
devtools::install("../bpwtpR")
devtools::install()
install.packages("DescTools")
devtools::install()
installed.packages("janitor")
install.packages("janitor")
devtools::install()
